<!doctype html>
<html ng-app="angTask">

<head>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular.js"></script>
    <script src="http://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.9.0.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <style>
    .red .progress-bar{
        background-color: red !important;
    }
    </style>
</head>

<body ng-controller="ProgressCtrl">
    <br>
    <br>
    <div class="row">
        <div class="col-md-3">
        </div>
        <div class="col-md-6">
            <div ng-class="{'red': value > 100}" ng-repeat="(key, value) in enpoint.bars  track by $index">
                <progressbar value="value"><span style="color:black; white-space:nowrap;">{{value}}%</span></progressbar>
            </div>
            


        </div>
        <div class="col-md-3">
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
        </div>
        <div class="col-md-3">
            <div>
                <select ng-model="progress.barId" >


                    <option ng-repeat="(key, value) in enpoint.bars  track by $index" value="{{$index}}">#progress{{$index+1}}</option>
                </select>

            </div>
        </div>
        <div class="col-md-3" style="text-align: right;">
            <button type="button" class="btn btn-sm btn-primary" ng-click="clickBtn(enpoint.buttons[0])">{{enpoint.buttons[0]}}</button>
            <button type="button" class="btn btn-sm btn-primary" ng-click="clickBtn(enpoint.buttons[1])">{{enpoint.buttons[1]}}</button>
            <button type="button" class="btn btn-sm btn-primary" ng-click="clickBtn(enpoint.buttons[2])">{{enpoint.buttons[2]}}</button>
            <button type="button" class="btn btn-sm btn-primary" ng-click="clickBtn(enpoint.buttons[3])">{{enpoint.buttons[3]}}</button>
        </div>
        <div class="col-md-3">
        </div>

    </div>
    <script>
    //angular.module('angTask', ['ui.bootstrap']);
var app = angular.module('angTask', ['ui.bootstrap']);

app.factory('service', function($http){
    return {
        getEndPoint : function(){
            return $http.get('http://pb-api.herokuapp.com/bars', {});
        }
    };   
    
});

app.controller('ProgressCtrl', function ($scope, $interval, service) {
    service.getEndPoint().then(function(result){
        $scope.enpoint = result.data;
    });
  

  $scope.progress = {};
  $scope.progress.barId = "0";


  $scope.clickBtn = function (value) {
    var dynamicvalue = $scope.enpoint.bars[$scope.progress.barId] + value;   

    if (dynamicvalue >= 0) {
        if(dynamicvalue > $scope.enpoint.limit){
            $scope.enpoint.bars[$scope.progress.barId] = $scope.enpoint.limit;
        }
        else{
             $scope.enpoint.bars[$scope.progress.barId] = dynamicvalue;
        }     
    }
    else {
      $scope.enpoint.bars[$scope.progress.barId] = 0;
    }

  }


});
</script>
</body>

</html>